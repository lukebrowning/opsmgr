# OpsMgr profile - generated by ansible
#

# new containers to create
containers:
  - name: nagios
    role: nagios
    release: trusty
    ports:
      - { name: "http", host: 8001, container:   80 }
      - { name: "nrpe", host: 5601, container: 5666 }
    mount: usr/local/nagios/opsmgr/nagios_config
  - name: logstash
    role: logstash
    release: trusty
    ports:
      - { name: "json", host: 5140, container: 5140 }
      - { name: "sysl", host: 5544, container: 5544 }
    mount: etc/opsmgr/shared/logstash
  - name: elasticsearch
    role: elasticsearch
    release: trusty
    ports:
      - { name: "http", host: 9200, container: 9200 }
    mount: var/lib/elasticsearch
  - name: kibana
    role: kibana
    release: trusty
    ports:
      - { name: "https", host: 8443, container: 8443 }
    mount: etc/opsmgr/shared/kibana

# containers imported from osa to reuse and install opsmgr components
import_containers:
{% for item in groups['horizon_container'] %}
{% if hostvars[item].component == 'horizon' %}
{% set physical_host = hostvars[item].physical_host %}
  - name:     {{ hostvars[item].container_name }}
    role:     core
    address:  {{ hostvars[item].container_address }}
    host:     {{ physical_host }}
    hostaddr: {{ hostvars[physical_host].ansible_ssh_host }}
    hostname: {{ item }}
{% endif %}
{% endfor %}

# container network installation
create_lxc_network: true
main_lxc_interface: "eth1"
lxc_container_default_mtu: 1500
address_pool: [ 172.29.236.30, 172.29.236.31, 172.29.236.32, 172.29.236.33, 172.29.236.34, 172.29.236.36, 172.29.236.38, 172.29.236.39, 172.29.236.40, 172.29.236.41, 172.29.236.42, 172.29.236.44, 172.29.236.45, 172.29.236.46, 172.29.236.47, 172.29.236.48, 172.29.236.49, 172.29.236.50 ]
opsmgr_lxc_nets:
  - name: "mgmt"
    bridge: "br-mgmt"
    interface: "eth1"
    netmask: "255.255.252.0"
    type: "veth"

# database installation
install_mysql: false
db_login_user: "{{ galera_root_user }}"
db_login_password: "{{ galera_root_password }}"
db_login_host: "{{ global_overrides.internal_lb_vip_address }}"
db_user: "opsmgr"
db_password: "passw0rd"
db_host: "{{ global_overrides.internal_lb_vip_address }}"

# user interface installation
install_ui: true
floating_ip: "{{ global_overrides.external_lb_vip_address }}"
ui_enabled: "{{ horizon_lib_dir | dirname | replace('untagged', openstack_release) }}/site-packages/openstack_dashboard/local"

# proxy mode installation - valid values: iptables or haproxy
install_haproxy: false
internal_ip: "{{ global_overrides.internal_lb_vip_address }}"

